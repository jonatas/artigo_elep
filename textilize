#!/opt/local/bin/ruby1.8.7
require 'rubygems'
require 'RedCloth'
require 'coderay'
require 'redclothcoderay'

Template = %{
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xml:lang="en-US" lang="en-US" xmlns="http://www.w3.org/1999/xhtml">
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
  <head>
  <title>%s</title>
  <link href="article.css" media="all" rel="stylesheet" type="text/css" />
  <link href="coderay.css" media="all" rel="stylesheet" type="text/css" />
  </head>
  <body>
  %s
  </body>
</html>
}

arquivo = ARGV.shift
titulo = arquivo.gsub(/\.markdown$/,'').tr('_',' ')

begin
  $stdout.puts(Template % [
                 titulo, 
                 RedCloth::new(IO.read(arquivo)).to_html( :markdown, :ruby)
               ])
rescue
	$stderr.puts "Abortando: Erro Fatal: %s \n %s", $!,$@
	exit 255
end
